<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>å¤§å¯Œç¿é“å…·ç‰ˆ</title>
  <style>
    body { font-family: sans-serif; background: #e0f7fa; text-align: center; }
    #board {
      display: grid;
      grid-template-columns: repeat(5, 80px);
      grid-template-rows: repeat(5, 80px);
      gap: 2px;
      justify-content: center;
      margin: 20px auto;
    }
    .tile {
      border: 1px solid #555;
      background: #fff8e1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      flex-direction: column;
      text-align: center;
    }
    .player {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      position: absolute;
      bottom: 5px;
    }
    .player0 { background: red; right: 35px; }
    .player1 { background: blue; right: 15px; }
    .player2 { background: green; left: 15px; }
    .player3 { background: purple; left: 35px; }
    .owner { font-size: 10px; color: green; }
    .level { font-size: 10px; color: orange; }
    button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    #info { margin-top: 10px; font-weight: bold; }
    #timer { font-size: 14px; margin: 5px; color: #444; }
  </style>
</head>
<body>
  <h1>ğŸ² å¤§å¯Œç¿ï¼ˆå¸¦é“å…· + å›åˆè®¡æ—¶ï¼‰</h1>
  <div id="board"></div>
  <button onclick="rollDice()">æ·éª°å­ ğŸ²</button>
  <button onclick="useItem('shield')">ğŸ›¡ï¸ æŠ¤ç›¾</button>
  <button onclick="useItem('bomb')">ğŸ’£ ç‚¸å¼¹</button>
  <button onclick="useItem('swap')">ğŸ”„ äº¤æ¢ä½ç½®</button>
  <div id="timer"></div>
  <div id="info"></div>

  <script>
    const board = document.getElementById('board');
    const info = document.getElementById('info');
    const timerDisplay = document.getElementById('timer');
    const size = 5;
    const totalTiles = size * 4 - 4;
    const capitalNames = ["åŒ—äº¬","ä¸œäº¬","å·´é»","ä¼¦æ•¦","åç››é¡¿","è«æ–¯ç§‘","æŸæ—","ç½—é©¬","æ¸¥å¤ªå","é©¬å¾·é‡Œ","æ±‰åŸ","å ªåŸ¹æ‹‰","å·´è¥¿åˆ©äºš","å¼€ç½—","æ–°å¾·é‡Œ","ä¼Šæ–¯å…°å ¡","åˆ©é›…å¾—","å®‰å¡æ‹‰","é˜¿å¸ƒè´¾","æ›¼è°·"];

    const players = [
      { name: 'ç©å®¶A', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶B', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶C', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶D', pos: 0, money: 1000, shield: false }
    ];
    let currentPlayer = 0;
    let turnTimer;
    const tiles = [];
    const tileOwners = Array(totalTiles).fill(null);
    const tileLevels = Array(totalTiles).fill(0);
    const tilePrices = Array(totalTiles).fill(200);

    function createBoard() {
      for (let i = 0; i < size * size; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.innerText = i;
        board.appendChild(tile);
        tiles.push(tile);
      }
      updateBoard();
    }

    function getTileIndex(n) {
      if (n < size) return n;
      if (n < size + size - 1) return (n - size + 1) * size - 1;
      if (n < size * 3 - 2) return size * size - (n - (2 * size - 2)) - 1;
      return size * (size - (n - (3 * size - 3)) - 1);
    }

    function updateBoard() {
      tiles.forEach((tile, i) => {
        tile.innerHTML = `${capitalNames[i % capitalNames.length]}`;
        if (tileOwners[i]) {
          const owner = document.createElement('div');
          owner.className = 'owner';
          owner.innerText = `ğŸ  ${tileOwners[i]}`;
          tile.appendChild(owner);
        }
        if (tileLevels[i] > 0) {
          const level = document.createElement('div');
          level.className = 'level';
          level.innerText = `Lv.${tileLevels[i]}`;
          tile.appendChild(level);
        }
      });
      players.forEach((p, i) => {
        const pos = getTileIndex(p.pos % totalTiles);
        const token = document.createElement('div');
        token.className = `player player${i}`;
        tiles[pos].appendChild(token);
      });
      const p = players[currentPlayer];
      info.innerHTML = `ğŸ¯ å½“å‰ï¼š${p.name}ï½œä½ç½®ï¼š${p.pos % totalTiles}ï½œğŸ’° $${p.money}${p.shield ? ' ğŸ›¡ï¸' : ''}`;
    }

    function rollDice() {
      clearTimeout(turnTimer);
      const p = players[currentPlayer];
      const roll = Math.floor(Math.random() * 6) + 1;
      p.pos += roll;
      const tile = p.pos % totalTiles;
      alert(`${p.name} æ·å‡º ${roll} ç‚¹ï¼Œç§»åŠ¨åˆ° ${capitalNames[tile % capitalNames.length]}`);

      if (tileOwners[tile] === null) {
        if (confirm(`è¯¥åœ°æ— äººæŒæœ‰ï¼Œæ˜¯å¦èŠ± $${tilePrices[tile]} è´­ä¹°ï¼Ÿ`)) {
          if (p.money >= tilePrices[tile]) {
            p.money -= tilePrices[tile];
            tileOwners[tile] = p.name;
            tileLevels[tile] = 1;
            alert(`${p.name} æˆåŠŸè´­å…¥ Lv.1 æˆ¿äº§ï¼`);
          }
        }
      } else if (tileOwners[tile] === p.name) {
        if (confirm(`ä½ æ˜¯è¯¥åœ°ä¸»äººï¼Œæ˜¯å¦èŠ± $200 å‡çº§ï¼Ÿ`)) {
          if (p.money >= 200) {
            tileLevels[tile]++;
            p.money -= 200;
          }
        }
      } else {
        const toll = 100 * (tileLevels[tile] || 1);
        if (p.shield) {
          alert(`ğŸ›¡ï¸ æŠ¤ç›¾ç”Ÿæ•ˆï¼å…é™¤ $${toll} è¿‡è·¯è´¹`);
          p.shield = false;
        } else {
          p.money -= toll;
          alert(`${p.name} è¿›å…¥ ${tileOwners[tile]} çš„ Lv.${tileLevels[tile]} åœ°ï¼Œæ”¯ä»˜ $${toll}`);
        }
      }

      if (tile % 5 === 0) {
        const fate = Math.random();
        if (fate < 0.5) {
          const bonus = Math.floor(Math.random() * 200);
          p.money += bonus;
          alert(`ğŸƒ å¹¸è¿äº‹ä»¶ï¼šè·å¾— $${bonus}`);
        } else {
          const bomb = 150;
          p.money -= bomb;
          alert(`ğŸ’£ è¸©åˆ°ç‚¸å¼¹ï¼Œå¤±å» $${bomb}`);
        }
      }

      if (p.money <= 0) {
        alert(`${p.name} ç ´äº§ï¼Œæ¸¸æˆç»“æŸï¼`);
        location.reload();
        return;
      }

      currentPlayer = (currentPlayer + 1) % players.length;
      updateBoard();
      startTurnTimer();
    }

    function useItem(type) {
      const p = players[currentPlayer];
      if (type === 'shield') {
        p.shield = true;
        alert(`${p.name} ä½¿ç”¨äº†æŠ¤ç›¾ï¼ä¸‹æ¬¡å…é™¤è¿‡è·¯è´¹`);
      } else if (type === 'bomb') {
        const targets = players.filter((_, i) => i !== currentPlayer);
        targets.forEach(t => t.money -= 100);
        alert(`ğŸ’£ ${p.name} ä½¿ç”¨ç‚¸å¼¹ï¼Œå…¶ä»–äººå„æ‰£ $100`);
      } else if (type === 'swap') {
        const target = (currentPlayer + 1) % players.length;
        [players[currentPlayer].pos, players[target].pos] = [players[target].pos, players[currentPlayer].pos];
        alert(`ğŸ”„ ${p.name} ä¸ ${players[target].name} äº¤æ¢äº†ä½ç½®ï¼`);
      }
      updateBoard();
    }

    function startTurnTimer() {
      let seconds = 15;
      timerDisplay.innerText = `â³ å€’è®¡æ—¶ï¼š${seconds} ç§’`;
      turnTimer = setInterval(() => {
        seconds--;
        timerDisplay.innerText = `â³ å€’è®¡æ—¶ï¼š${seconds} ç§’`;
        if (seconds <= 0) {
          clearInterval(turnTimer);
          alert('â° è¶…æ—¶ï¼è‡ªåŠ¨è·³è¿‡å›åˆ');
          currentPlayer = (currentPlayer + 1) % players.length;
          updateBoard();
          startTurnTimer();
        }
      }, 1000);
    }

    createBoard();
    startTurnTimer();
  </script>
</body>
</html>