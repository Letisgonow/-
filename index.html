<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>å¤§å¯Œç¿é“å…·ç‰ˆ</title>
  <style>
    body { font-family: sans-serif; background: #e0f7fa; text-align: center; }
    #board {
      display: grid;
      grid-template-columns: repeat(5, 80px);
      grid-template-rows: repeat(5, 80px);
      gap: 2px;
      justify-content: center;
      margin: 20px auto;
    }
    .tile {
      border: 1px solid #555;
      background: #fff8e1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      flex-direction: column;
      text-align: center;
    }
    .player {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      position: absolute;
      bottom: 5px;
    }
    .player0 { background: red; right: 35px; }
    .player1 { background: blue; right: 15px; }
    .player2 { background: green; left: 15px; }
    .player3 { background: purple; left: 35px; }
    .owner { font-size: 10px; color: green; }
    .level { font-size: 10px; color: orange; }
    button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    #info { margin-top: 10px; font-weight: bold; }
    #timer { font-size: 14px; margin: 5px; color: #444; }
    #log { text-align: left; max-width: 500px; margin: 20px auto; background: #fff; border: 1px solid #ccc; padding: 10px; height: 150px; overflow-y: auto; font-size: 12px; }
    #dice { height: 60px; display: none; margin: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ² å¤§å¯Œç¿ï¼ˆèƒœè´Ÿ + æˆ˜æŠ¥ + éª°å­åŠ¨ç”»ï¼‰</h1>
  <div id="board"></div>
  <button onclick="rollDice()">æ·éª°å­ ğŸ²</button>
  <button onclick="useItem('shield')">ğŸ›¡ï¸ æŠ¤ç›¾</button>
  <button onclick="useItem('bomb')">ğŸ’£ ç‚¸å¼¹</button>
  <button onclick="useItem('swap')">ğŸ”„ äº¤æ¢ä½ç½®</button>
  <div><img id="dice" src="" alt="dice"></div>
  <div id="timer"></div>
  <div id="info"></div>
  <div id="log"></div>

  <script>
    const board = document.getElementById('board');
    const info = document.getElementById('info');
    const timerDisplay = document.getElementById('timer');
    const logBox = document.getElementById('log');
    const dice = document.getElementById('dice');
    const size = 5;
    const totalTiles = size * 4 - 4;
    const capitalNames = ["åŒ—äº¬","ä¸œäº¬","å·´é»","ä¼¦æ•¦","åç››é¡¿","è«æ–¯ç§‘","æŸæ—","ç½—é©¬","æ¸¥å¤ªå","é©¬å¾·é‡Œ","æ±‰åŸ","å ªåŸ¹æ‹‰","å·´è¥¿åˆ©äºš","å¼€ç½—","æ–°å¾·é‡Œ","ä¼Šæ–¯å…°å ¡","åˆ©é›…å¾—","å®‰å¡æ‹‰","é˜¿å¸ƒè´¾","æ›¼è°·"];

    const players = [
      { name: 'ç©å®¶A', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶B', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶C', pos: 0, money: 1000, shield: false },
      { name: 'ç©å®¶D', pos: 0, money: 1000, shield: false }
    ];

    let currentPlayer = 0;
    let turnTimer;
    let round = 0;
    const maxRounds = 20;

    const tiles = [];
    const tileOwners = Array(totalTiles).fill(null);
    const tileLevels = Array(totalTiles).fill(0);
    const tilePrices = Array(totalTiles).fill(200);

    function createBoard() {
      for (let i = 0; i < size * size; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.innerText = i;
        board.appendChild(tile);
        tiles.push(tile);
      }
      updateBoard();
    }

    function getTileIndex(n) {
      if (n < size) return n;
      if (n < size + size - 1) return (n - size + 1) * size - 1;
      if (n < size * 3 - 2) return size * size - (n - (2 * size - 2)) - 1;
      return size * (size - (n - (3 * size - 3)) - 1);
    }

    function updateBoard() {
      tiles.forEach((tile, i) => {
        tile.innerHTML = `${capitalNames[i % capitalNames.length]}`;
        if (tileOwners[i]) {
          const owner = document.createElement('div');
          owner.className = 'owner';
          owner.innerText = `ğŸ  ${tileOwners[i]}`;
          tile.appendChild(owner);
        }
        if (tileLevels[i] > 0) {
          const level = document.createElement('div');
          level.className = 'level';
          level.innerText = `Lv.${tileLevels[i]}`;
          tile.appendChild(level);
        }
      });
      players.forEach((p, i) => {
        const pos = getTileIndex(p.pos % totalTiles);
        const token = document.createElement('div');
        token.className = `player player${i}`;
        tiles[pos].appendChild(token);
      });
      const p = players[currentPlayer];
      info.innerHTML = `ğŸ¯ å½“å‰ï¼š${p.name}ï½œç¬¬ ${round + 1} è½®ï½œä½ç½®ï¼š${p.pos % totalTiles}ï½œğŸ’° $${p.money}${p.shield ? ' ğŸ›¡ï¸' : ''}`;
    }

    function log(text) {
      const p = document.createElement('div');
      p.textContent = text;
      logBox.prepend(p);
    }

    function rollDice() {
      clearTimeout(turnTimer);
      dice.src = "dice_roll.gif";
      dice.style.display = "inline";

      setTimeout(() => {
        const roll = Math.floor(Math.random() * 6) + 1;
        dice.src = `https://upload.wikimedia.org/wikipedia/commons/${roll}.svg`; // æ›¿æ¢ä¸ºä½ æœ¬åœ° dice1.png ç­‰å¯é€‰
        dice.alt = `ğŸ² ${roll}`;

        const p = players[currentPlayer];
        p.pos += roll;
        const tile = p.pos % totalTiles;
        log(`${p.name} æ·å‡º ${roll}ï¼Œåˆ°è¾¾ ${capitalNames[tile % capitalNames.length]}`);

        if (tileOwners[tile] === null && p.money >= tilePrices[tile]) {
          p.money -= tilePrices[tile];
          tileOwners[tile] = p.name;
          tileLevels[tile] = 1;
          log(`${p.name} è´­ä¹°äº† Lv.1 æˆ¿äº§`);
        } else if (tileOwners[tile] === p.name && p.money >= 200) {
          tileLevels[tile]++;
          p.money -= 200;
          log(`${p.name} å‡çº§æˆ¿äº§è‡³ Lv.${tileLevels[tile]}`);
        } else if (tileOwners[tile] !== null && tileOwners[tile] !== p.name) {
          const toll = 100 * (tileLevels[tile] || 1);
          if (p.shield) {
            log(`${p.name} ä½¿ç”¨æŠ¤ç›¾å…è¿‡è·¯è´¹`);
            p.shield = false;
          } else {
            p.money -= toll;
            log(`${p.name} å‘ ${tileOwners[tile]} æ”¯ä»˜ $${toll}`);
          }
        }

        if (tile % 5 === 0) {
          const fate = Math.random();
          if (fate < 0.5) {
            const bonus = Math.floor(Math.random() * 200);
            p.money += bonus;
            log(`ğŸƒ å¹¸è¿äº‹ä»¶ï¼šè·å¾— $${bonus}`);
          } else {
            const bomb = 150;
            p.money -= bomb;
            log(`ğŸ’£ è¸©åˆ°ç‚¸å¼¹ï¼Œå¤±å» $${bomb}`);
          }
        }

        if (p.money <= 0) {
          alert(`${p.name} ç ´äº§ï¼Œæ¸¸æˆç»“æŸï¼`);
          showFinalResults();
          return;
        }

        currentPlayer++;
        if (currentPlayer >= players.length) {
          currentPlayer = 0;
          round++;
          if (round >= 20) {
            alert(`æ¸¸æˆè¿›è¡Œ ${round} è½®ï¼Œè‡ªåŠ¨ç»“æŸï¼`);
            showFinalResults();
            return;
          }
        }

        updateBoard();
        startTurnTimer();
      }, 1000);
    }

    function useItem(type) {
      const p = players[currentPlayer];
      if (type === 'shield') {
        p.shield = true;
        log(`${p.name} ä½¿ç”¨äº† ğŸ›¡ï¸ æŠ¤ç›¾`);
      } else if (type === 'bomb') {
        players.forEach((t, i) => {
          if (i !== currentPlayer) {
            t.money -= 100;
            log(`${p.name} å‘ ${t.name} æŠ•æ·ç‚¸å¼¹ ğŸ’£ -100`);
          }
        });
      } else if (type === 'swap') {
        const target = (currentPlayer + 1) % players.length;
        [players[currentPlayer].pos, players[target].pos] = [players[target].pos, players[currentPlayer].pos];
        log(`${p.name} ä¸ ${players[target].name} äº¤æ¢äº†ä½ç½® ğŸ”„`);
      }
      updateBoard();
    }

    function showFinalResults() {
      let results = [...players].sort((a, b) => b.money - a.money);
      let msg = 'ğŸ† æœ€ç»ˆæ’åï¼š\n';
      results.forEach((p, i) => {
        msg += `${i + 1}. ${p.name} - ğŸ’° $${p.money}\n`;
      });
      alert(msg);
      location.reload();
    }

    function startTurnTimer() {
      let seconds = 15;
      timerDisplay.innerText = `â³ å€’è®¡æ—¶ï¼š${seconds} ç§’`;
      turnTimer = setInterval(() => {
        seconds--;
        timerDisplay.innerText = `â³ å€’è®¡æ—¶ï¼š${seconds} ç§’`;
        if (seconds <= 0) {
          clearInterval(turnTimer);
          log(`â° ${players[currentPlayer].name} è¶…æ—¶ï¼Œè·³è¿‡å›åˆ`);
          currentPlayer = (currentPlayer + 1) % players.length;
          updateBoard();
          startTurnTimer();
        }
      }, 1000);
    }

    createBoard();
    startTurnTimer();
  </script>
</body>
</html>

